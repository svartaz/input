const fs = require("fs");
const OpenCC = require("opencc-js");
const convert = OpenCC.Converter({ from: "jp", to: "tw" });

const {
  replaceEach,
  pushUniquelyToValue,
  valueToSingleton,
} = require("./utility");

// hira, kana
const dict = valueToSingleton({
  " ": " ",

  a: "ã‚",
  i: "ã„",
  u: "ã†",
  e: "ãˆ",
  o: "ãŠ",
  _a: "ã",
  _i: "ãƒ",
  _u: "ã…",
  _e: "ã‡",
  _o: "ã‰",
  ka: "ã‹",
  ki: "ã",
  ku: "ã",
  ke: "ã‘",
  ko: "ã“",
  _ko: "ğ›„²",
  ca: "ãŒ",
  ci: "ã",
  cu: "ã",
  ce: "ã’",
  co: "ã”",
  sa: "ã•",
  si: "ã—",
  su: "ã™",
  se: "ã›",
  so: "ã",
  za: "ã–",
  zi: "ã˜",
  zu: "ãš",
  ze: "ãœ",
  zo: "ã",
  ta: "ãŸ",
  ti: "ã¡",
  tu: "ã¤",
  te: "ã¦",
  to: "ã¨",
  t: "ã£",
  _tu: "ã£",
  q: "ã£",
  da: "ã ",
  di: "ã¢",
  du: "ã¥",
  de: "ã§",
  do: "ã©",
  na: "ãª",
  ni: "ã«",
  nu: "ã¬",
  ne: "ã­",
  no: "ã®",
  fa: "ã¯",
  fi: "ã²",
  fu: "ãµ",
  fe: "ã¸",
  fo: "ã»",
  pa: "ã±",
  pi: "ã´",
  pu: "ã·",
  pe: "ãº",
  po: "ã½",
  ba: "ã°",
  bi: "ã³",
  bu: "ã¶",
  be: "ã¹",
  bo: "ã¼",
  ma: "ã¾",
  mi: "ã¿",
  mu: "ã‚€",
  me: "ã‚",
  mo: "ã‚‚",
  ja: "ã‚„",
  ji: "ğ›€†",
  ju: "ã‚†",
  je: "ğ›€",
  jo: "ã‚ˆ",
  _ja: "ã‚ƒ",
  _ju: "ã‚…",
  _jo: "ã‚‡",
  ra: "ã‚‰",
  ri: "ã‚Š",
  ru: "ã‚‹",
  re: "ã‚Œ",
  ro: "ã‚",
  wa: "ã‚",
  wi: "ã‚",
  wu: "ğ›„Ÿ",
  we: "ã‚‘",
  wo: "ã‚’",
  _wa: "ã‚",
  _wi: "ğ›…",
  _we: "ğ›…‘",
  _wo: "ğ›…’",
  n: "ã‚“",
  l: "ã‚“",
  iti: "ã‚",
  "iti:": "ã‚",

  A: "ã‚¢",
  I: "ã‚¤",
  U: "ã‚¦",
  E: "ã‚¨",
  "E*": "ğ›€€",
  O: "ã‚ª",
  _A: "ã‚¡",
  _I: "ã‚£",
  _U: "ã‚¥",
  _E: "ã‚§",
  _O: "ã‚©",
  KA: "ã‚«",
  KI: "ã‚­",
  KU: "ã‚¯",
  KE: "ã‚±",
  KO: "ã‚³",
  _KA: "ãƒµ",
  _KU: "ã‡°",
  _KE: "ãƒ¶",
  _KO: "ğ›…•",
  CA: "ã‚¬",
  CI: "ã‚®",
  CU: "ã‚°",
  CE: "ã‚²",
  CO: "ã‚´",
  SA: "ã‚µ",
  SI: "ã‚·",
  SU: "ã‚¹",
  SE: "ã‚»",
  SO: "ã‚½",
  _SI: "ã‡±",
  _SU: "ã‡²",
  ZA: "ã‚¶",
  ZI: "ã‚¸",
  ZU: "ã‚º",
  ZE: "ã‚¼",
  ZO: "ã‚¾",
  TA: "ã‚¿",
  TI: "ãƒ",
  TU: "ãƒ„",
  TE: "ãƒ†",
  TO: "ãƒˆ",
  T: "ãƒƒ",
  Q: "ãƒƒ",
  _TU: "ãƒƒ",
  _TO: "ã‡³",
  DA: "ãƒ€",
  DI: "ãƒ‚",
  DU: "ãƒ…",
  DE: "ãƒ‡",
  DO: "ãƒ‰",
  NA: "ãƒŠ",
  NI: "ãƒ‹",
  NU: "ãƒŒ",
  NE: "ãƒ",
  NO: "ãƒ",
  _NU: "ã‡´",
  FA: "ãƒ",
  FI: "ãƒ’",
  FU: "ãƒ•",
  FE: "ãƒ˜",
  FO: "ãƒ›",
  _FA: "ã‡µ",
  _FI: "ã‡¶",
  _FU: "ã‡·",
  _FE: "ã‡¸",
  _FO: "ã‡¹",
  PA: "ãƒ‘",
  PI: "ãƒ”",
  PU: "ãƒ—",
  PE: "ãƒš",
  PO: "ãƒ",
  BA: "ãƒ",
  BI: "ãƒ“",
  BU: "ãƒ–",
  BE: "ãƒ™",
  BO: "ãƒœ",
  MA: "ãƒ",
  MI: "ãƒŸ",
  MU: "ãƒ ",
  ME: "ãƒ¡",
  MO: "ãƒ¢",
  _MU: "ã‡º",
  JA: "ãƒ¤",
  JI: "ğ›„ ",
  JU: "ãƒ¦",
  JE: "ğ›„¡",
  JO: "ãƒ¨",
  _JA: "ãƒ£",
  _JU: "ãƒ¥",
  _JO: "ãƒ§",
  RA: "ãƒ©",
  RI: "ãƒª",
  RU: "ãƒ«",
  RE: "ãƒ¬",
  RO: "ãƒ­",
  _RA: "ã‡»",
  _RI: "ã‡¼",
  _RU: "ã‡½",
  _RE: "ã‡¾",
  _RO: "ã‡¿",
  WA: "ãƒ¯",
  WI: "ãƒ°",
  WU: "ğ›„¢",
  WE: "ãƒ±",
  WO: "ãƒ²",
  _WA: "ãƒ®",
  _WI: "ğ›…¤",
  _WE: "ğ›…¥",
  _WO: "ğ›…¦",
  VA: "ãƒ·",
  VI: "ãƒ¸",
  VU: "ãƒ´",
  VE: "ãƒ¹",
  VO: "ãƒº",
  N: "ãƒ³",
  L: "ğ›…§",
  ITI: "ãƒ½",
  "ITI:": "ãƒ¾",

  "-": "ãƒ¼",
  ":": "\u3099",
  "#:": "ã‚›",
  "*": "\u309a",
  "#*": "ã‚œ",
  ",": "ã€",
  ".": "ã€‚",
  "?": "ï¼Ÿ",
  "!": "ï¼",
  "&": "ãƒ»",
  "..": "â€¥",
  "...": "â€¦",
  "(": "ï¼ˆ",
  ")": "ï¼‰",
  "[": "ã€Œ",
  "]": "ã€",
  "[[": "ã€",
  "]]": "ã€",
});

for (const isKata of [false, true]) {
  for (const k0 of "k c s z t d n f p b m j r w v".split(" "))
    for (const [vowel, ks1] of [
      ["i", "ja ju jo"],
      ["u", "wa wi we wo"],
    ])
      for (const k1 of ks1.split(" ")) {
        const v0 = isKata ? dict[(k0 + vowel).toUpperCase()] : dict[k0 + vowel];
        const v1 = isKata ? dict["_" + k1.toUpperCase()] : dict["_" + k1];
        const k = isKata ? (k0 + k1).toUpperCase() : k0 + k1;

        if (v0 && v1) dict[k] = [v0 + v1];
      }

  for (const k0 of "k c s z t d f p b r v".split(" "))
    for (const k1 of "a i u e o".split(" ")) {
      const v0 = isKata ? dict["_TU"] : dict["_tu"];
      const v1 = isKata ? dict[(k0 + k1).toUpperCase()] : dict[k0 + k1];
      const k = isKata ? (k0 + k0 + k1).toUpperCase() : k0 + k0 + k1;

      if (v1) dict[k] = [v0 + v1];
    }
}

// hanz word
for (let i = 0; i < 10; i++)
  for (const line of fs
    .readFileSync(
      `${__dirname}/../submodules/mozc/src/data/dictionary_oss/dictionary0${i}.txt`,
    )
    .toString()
    .trim()
    .split("\n")) {
    const row = line.split(/\t/g);
    if (!/^\p{sc=Han}+\p{sc=Hiragana}*$/u.test(row[4])) continue;

    const word = convert(row[4]);

    const latn = replaceEach(row[0], [
      [/ã‚/g, "a"],
      [/ã„/g, "i"],
      [/ã†/g, "u"],
      [/ãˆ/g, "e"],
      [/ãŠ/g, "o"],

      [/ã‹/g, "ka"],
      [/ã/g, "ki"],
      [/ã/g, "ku"],
      [/ã‘/g, "ke"],
      [/ã“/g, "ko"],

      [/ãŒ/g, "ca"],
      [/ã/g, "ci"],
      [/ã/g, "cu"],
      [/ã’/g, "ce"],
      [/ã”/g, "co"],

      [/ã•/g, "sa"],
      [/ã—/g, "si"],
      [/ã™/g, "su"],
      [/ã›/g, "se"],
      [/ã/g, "so"],

      [/ã–/g, "za"],
      [/ã˜/g, "zi"],
      [/ãš/g, "zu"],
      [/ãœ/g, "ze"],
      [/ã/g, "zo"],

      [/ãŸ/g, "ta"],
      [/ã¡/g, "ti"],
      [/ã¤/g, "tu"],
      [/ã¦/g, "te"],
      [/ã¨/g, "to"],

      [/ã /g, "da"],
      [/ã¢/g, "di"],
      [/ã¥/g, "du"],
      [/ã§/g, "de"],
      [/ã©/g, "do"],

      [/ãª/g, "na"],
      [/ã«/g, "ni"],
      [/ã¬/g, "nu"],
      [/ã­/g, "ne"],
      [/ã®/g, "no"],

      [/ã¯/g, "fa"],
      [/ã²/g, "fi"],
      [/ãµ/g, "fu"],
      [/ã¸/g, "fe"],
      [/ã»/g, "fo"],

      [/ã±/g, "pa"],
      [/ã´/g, "pi"],
      [/ã·/g, "pu"],
      [/ãº/g, "pe"],
      [/ã½/g, "po"],

      [/ã°/g, "ba"],
      [/ã³/g, "bi"],
      [/ã¶/g, "bu"],
      [/ã¹/g, "be"],
      [/ã¼/g, "bo"],

      [/ã¾/g, "ma"],
      [/ã¿/g, "mi"],
      [/ã‚€/g, "mu"],
      [/ã‚/g, "me"],
      [/ã‚‚/g, "mo"],

      [/ã‚„/g, "ja"],
      [/ã‚†/g, "ju"],
      [/ã‚ˆ/g, "jo"],

      [/ã‚‰/g, "ra"],
      [/ã‚Š/g, "ri"],
      [/ã‚‹/g, "ru"],
      [/ã‚Œ/g, "re"],
      [/ã‚/g, "ro"],

      [/ã‚/g, "wa"],
      [/ã‚/g, "wi"],
      [/ã‚‘/g, "we"],
      [/ã‚’/g, "wo"],

      [/ã‚“/g, "n"],
      [/ã£(.)/g, "$1$1"],
      [/ã£/g, "t"],
      [/iã‚ƒ/g, "ja"],
      [/iã‚…/g, "ju"],
      [/iã‚‡/g, "jo"],
      [/uã‚/g, "wa"],

      [/juu/g, "iu"],
      [/jou/g, "eu"],

      [/(.)(.+)/, (_, a, b) => a.toUpperCase() + b],
    ]);

    pushUniquelyToValue(dict, latn, word);
  }

fs.writeFileSync(
  __dirname + "/../SumiInput/dicts.bundle/ja.json",
  JSON.stringify({ name: "æ—¥", dict }),
);
